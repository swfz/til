---
title: "Dataportalで時間の単位をよしなに扱う計算フィールド"
date: "2021-06-18"
description: "RoundとかFloorとか"
tags:
  - DataPortal
  - GoogleCloudPlatform
---

## 0.5単位で表示する

```
Round(hour / 0.5, 0) * 0.5
```

よくある0.5時間で丸めるやり方

厳密に0.2だよねとか0.4だよねと言ってもピンとこないといえばピンと来ないので0.5刻みで良いよねという感じの表現

ざっとどのくらい時間つかっているのかなみたいなのが知りたいのであればこのパターンで問題ない気がしている

## 時間 + 分を60進数で表示する

```
FLOOR(SUM(hour)) + ((sum(hour) - FLOOR(SUM(hour))) * 60.0 / 100)
```

1.7 -> 1.42

1時間42分という感じ

グラフで見た場合時間単位のみで表示するとどうしても「あぁ0.7だから…42分ね」みたいな脳内変換をしがち

そのへんの認知負荷を下げるためにこういう感じで計算フィールドを用意するとそれっぽく表示してくれる

ビポットで使っても合計の計算もしっかり行われているので問題なさそう

うまくはまらないパターン

- `前期間との比較`がある場合はうまく計算できない
    - 比較が10進数を前提としているため
- グラフ表示だと`60`～`100`までの数値を取ることがなくなるので不自然な増減が起きる
    - こちらも10進数を前提としているため

<!-- textlint-disable prh -->
使える部分は表やピボットでの数値表示のときくらい
<!-- textlint-enable prh -->